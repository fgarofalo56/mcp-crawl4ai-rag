<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 1100" style="background: #ffffff;">
  <defs>
    <!-- Gradients for swimlanes -->
    <linearGradient id="userGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:0.2" />
      <stop offset="100%" style="stop-color:#667eea;stop-opacity:0.1" />
    </linearGradient>
    <linearGradient id="cliGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f093fb;stop-opacity:0.2" />
      <stop offset="100%" style="stop-color:#f093fb;stop-opacity:0.1" />
    </linearGradient>
    <linearGradient id="coreGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#4facfe;stop-opacity:0.2" />
      <stop offset="100%" style="stop-color:#4facfe;stop-opacity:0.1" />
    </linearGradient>
    <linearGradient id="agentGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#43e97b;stop-opacity:0.2" />
      <stop offset="100%" style="stop-color:#43e97b;stop-opacity:0.1" />
    </linearGradient>
    <linearGradient id="mcpGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#fa709a;stop-opacity:0.2" />
      <stop offset="100%" style="stop-color:#fa709a;stop-opacity:0.1" />
    </linearGradient>
    <linearGradient id="kbGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#9c27b0;stop-opacity:0.2" />
      <stop offset="100%" style="stop-color:#9c27b0;stop-opacity:0.1" />
    </linearGradient>

    <!-- Arrow markers -->
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#333" />
    </marker>
    <marker id="arrowReturn" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#666" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="800" y="35" font-family="Arial, sans-serif" font-size="28" font-weight="bold" text-anchor="middle" fill="#333">
    Claude Code Data Flow Diagram
  </text>
  <text x="800" y="60" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#666">
    Complete Request/Response Cycle with Agent and MCP Integration
  </text>

  <!-- Swimlane Headers -->
  <rect x="30" y="90" width="1540" height="50" fill="#f5f5f5" stroke="#ddd" stroke-width="1" />

  <!-- Swimlane Labels -->
  <text x="120" y="120" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">User</text>
  <text x="340" y="120" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">CLI/Parser</text>
  <text x="580" y="120" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">Core Engine</text>
  <text x="870" y="120" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">Agent Layer</text>
  <text x="1130" y="120" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">MCP Servers</text>
  <text x="1420" y="120" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">Knowledge Base</text>

  <!-- Swimlanes -->
  <rect x="30" y="140" width="220" height="900" fill="url(#userGradient)" stroke="#ddd" stroke-width="1" />
  <rect x="250" y="140" width="220" height="900" fill="url(#cliGradient)" stroke="#ddd" stroke-width="1" />
  <rect x="470" y="140" width="250" height="900" fill="url(#coreGradient)" stroke="#ddd" stroke-width="1" />
  <rect x="720" y="140" width="270" height="900" fill="url(#agentGradient)" stroke="#ddd" stroke-width="1" />
  <rect x="990" y="140" width="270" height="900" fill="url(#mcpGradient)" stroke="#ddd" stroke-width="1" />
  <rect x="1260" y="140" width="310" height="900" fill="url(#kbGradient)" stroke="#ddd" stroke-width="1" />

  <!-- Flow Steps -->

  <!-- Step 1: User Input -->
  <rect x="50" y="170" width="180" height="60" rx="8" fill="#667eea" stroke="#5a67d8" stroke-width="2" />
  <text x="140" y="195" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    1. User Input
  </text>
  <text x="140" y="215" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    /research-validate-
  </text>
  <text x="140" y="228" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    implement "feature"
  </text>

  <!-- Arrow 1 to 2 -->
  <path d="M 230 200 L 270 200" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)" />

  <!-- Step 2: Parse & Validate -->
  <rect x="270" y="170" width="180" height="60" rx="8" fill="#f093fb" stroke="#e91e63" stroke-width="2" />
  <text x="360" y="195" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    2. Parse Input
  </text>
  <text x="360" y="215" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Extract command
  </text>
  <text x="360" y="228" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    and parameters
  </text>

  <!-- Arrow 2 to 3 -->
  <path d="M 450 200 L 490 200" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)" />

  <!-- Step 3: Route Command -->
  <rect x="490" y="170" width="210" height="60" rx="8" fill="#4facfe" stroke="#0288d1" stroke-width="2" />
  <text x="595" y="195" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    3. Route Command
  </text>
  <text x="595" y="215" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Load command definition
  </text>
  <text x="595" y="228" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Check permissions
  </text>

  <!-- Step 4: Phase 1 - Research -->
  <rect x="490" y="270" width="210" height="60" rx="8" fill="#4facfe" stroke="#0288d1" stroke-width="2" />
  <text x="595" y="295" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    4. Phase 1: Research
  </text>
  <text x="595" y="315" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Invoke research agent
  </text>

  <!-- Arrow 3 to 4 -->
  <path d="M 595 230 L 595 270" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)" />

  <!-- Arrow 4 to Agent -->
  <path d="M 700 300 L 740 300" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)" />

  <!-- Step 5: Agent Execution -->
  <rect x="740" y="270" width="230" height="60" rx="8" fill="#43e97b" stroke="#00bfa5" stroke-width="2" />
  <text x="855" y="295" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    5. Research Agent
  </text>
  <text x="855" y="315" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Initialize context
  </text>
  <text x="855" y="328" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Process task
  </text>

  <!-- Arrow Agent to MCP -->
  <path d="M 970 300 L 1010 300" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)" />

  <!-- Step 6: MCP Call -->
  <rect x="1010" y="270" width="230" height="60" rx="8" fill="#fa709a" stroke="#ff9800" stroke-width="2" />
  <text x="1125" y="290" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    6. MCP Server Call
  </text>
  <text x="1125" y="308" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    microsoft_docs_search
  </text>
  <text x="1125" y="323" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    ("feature documentation")
  </text>

  <!-- Arrow MCP return -->
  <path d="M 1010 320 L 970 320" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowReturn)" stroke-dasharray="5,5" />
  <text x="990" y="342" font-family="Arial, sans-serif" font-size="9" fill="#666">
    docs
  </text>

  <!-- Step 7: Search Code -->
  <rect x="740" y="380" width="230" height="60" rx="8" fill="#43e97b" stroke="#00bfa5" stroke-width="2" />
  <text x="855" y="405" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    7. Search Code
  </text>
  <text x="855" y="425" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Use Grep/Read tools
  </text>

  <!-- Arrow Agent to MCP (Serena) -->
  <path d="M 970 410 L 1010 410" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)" />

  <!-- Step 8: Serena Search -->
  <rect x="1010" y="380" width="230" height="60" rx="8" fill="#fa709a" stroke="#ff9800" stroke-width="2" />
  <text x="1125" y="400" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    8. Serena: find_symbol
  </text>
  <text x="1125" y="418" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Search codebase for
  </text>
  <text x="1125" y="433" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    similar patterns
  </text>

  <!-- Arrow MCP return -->
  <path d="M 1010 430 L 970 430" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowReturn)" stroke-dasharray="5,5" />
  <text x="990" y="452" font-family="Arial, sans-serif" font-size="9" fill="#666">
    code
  </text>

  <!-- Arrow Agent to KB -->
  <path d="M 855 440 L 855 480 L 1280 480" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)" />

  <!-- Step 9: KB Search -->
  <rect x="1280" y="460" width="270" height="60" rx="8" fill="#9c27b0" stroke="#7b1fa2" stroke-width="2" />
  <text x="1415" y="480" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    9. Search Knowledge Base
  </text>
  <text x="1415" y="498" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Find similar implementations
  </text>
  <text x="1415" y="513" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Past learnings
  </text>

  <!-- Arrow KB return -->
  <path d="M 1280 510 L 855 510 L 855 440" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowReturn)" stroke-dasharray="5,5" />
  <text x="1050" y="528" font-family="Arial, sans-serif" font-size="9" fill="#666">
    patterns
  </text>

  <!-- Arrow Agent return to Core -->
  <path d="M 740 360 L 700 360" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowReturn)" stroke-dasharray="5,5" />
  <text x="715" y="352" font-family="Arial, sans-serif" font-size="9" fill="#666">
    research results
  </text>

  <!-- Step 10: Phase 2 - Validation -->
  <rect x="490" y="570" width="210" height="60" rx="8" fill="#4facfe" stroke="#0288d1" stroke-width="2" />
  <text x="595" y="595" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    10. Phase 2: Validate
  </text>
  <text x="595" y="615" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Invoke validation agent
  </text>

  <!-- Arrow Core to Agent -->
  <path d="M 700 600 L 740 600" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)" />

  <!-- Step 11: Validation Agent -->
  <rect x="740" y="570" width="230" height="60" rx="8" fill="#43e97b" stroke="#00bfa5" stroke-width="2" />
  <text x="855" y="590" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    11. Validation Agent
  </text>
  <text x="855" y="608" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Run tests
  </text>
  <text x="855" y="623" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Check quality gates
  </text>

  <!-- Arrow Agent return -->
  <path d="M 740 620 L 700 620" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowReturn)" stroke-dasharray="5,5" />
  <text x="715" y="612" font-family="Arial, sans-serif" font-size="9" fill="#666">
    validation ✓
  </text>

  <!-- Step 12: Phase 3 - Implement -->
  <rect x="490" y="680" width="210" height="60" rx="8" fill="#4facfe" stroke="#0288d1" stroke-width="2" />
  <text x="595" y="705" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    12. Phase 3: Implement
  </text>
  <text x="595" y="725" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Invoke implementation agent
  </text>

  <!-- Arrow Core to Agent -->
  <path d="M 700 710 L 740 710" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)" />

  <!-- Step 13: Implementation Agent -->
  <rect x="740" y="680" width="230" height="60" rx="8" fill="#43e97b" stroke="#00bfa5" stroke-width="2" />
  <text x="855" y="700" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    13. Implementation
  </text>
  <text x="855" y="718" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Write/Edit files
  </text>
  <text x="855" y="733" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Create feature
  </text>

  <!-- Arrow Agent return -->
  <path d="M 740 730 L 700 730" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowReturn)" stroke-dasharray="5,5" />
  <text x="715" y="722" font-family="Arial, sans-serif" font-size="9" fill="#666">
    code created
  </text>

  <!-- Step 14: Store Knowledge -->
  <rect x="490" y="790" width="210" height="60" rx="8" fill="#4facfe" stroke="#0288d1" stroke-width="2" />
  <text x="595" y="815" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    14. Store Learnings
  </text>
  <text x="595" y="835" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Update knowledge base
  </text>

  <!-- Arrow Core to KB -->
  <path d="M 700 820 L 1280 820" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)" />

  <!-- Step 15: KB Update -->
  <rect x="1280" y="790" width="270" height="60" rx="8" fill="#9c27b0" stroke="#7b1fa2" stroke-width="2" />
  <text x="1415" y="810" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    15. Update KB
  </text>
  <text x="1415" y="828" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Store patterns
  </text>
  <text x="1415" y="843" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Store learnings
  </text>

  <!-- Arrow KB return -->
  <path d="M 1280 840 L 700 840" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowReturn)" stroke-dasharray="5,5" />
  <text x="980" y="858" font-family="Arial, sans-serif" font-size="9" fill="#666">
    stored ✓
  </text>

  <!-- Step 16: Format Output -->
  <rect x="490" y="900" width="210" height="60" rx="8" fill="#4facfe" stroke="#0288d1" stroke-width="2" />
  <text x="595" y="925" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    16. Format Output
  </text>
  <text x="595" y="945" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Apply output style
  </text>

  <!-- Arrow Core to CLI -->
  <path d="M 490 930 L 450 930" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowReturn)" stroke-dasharray="5,5" />

  <!-- Step 17: Display Results -->
  <rect x="270" y="900" width="180" height="60" rx="8" fill="#f093fb" stroke="#e91e63" stroke-width="2" />
  <text x="360" y="925" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    17. Display Results
  </text>
  <text x="360" y="945" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Format for user
  </text>

  <!-- Arrow CLI to User -->
  <path d="M 270 930 L 230 930" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowReturn)" stroke-dasharray="5,5" />

  <!-- Step 18: User Receives -->
  <rect x="50" y="900" width="180" height="60" rx="8" fill="#667eea" stroke="#5a67d8" stroke-width="2" />
  <text x="140" y="920" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
    18. Receive Output
  </text>
  <text x="140" y="938" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    Feature implemented
  </text>
  <text x="140" y="953" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#fff">
    with complete summary
  </text>

  <!-- Vertical connection lines -->
  <path d="M 595 330 L 595 570" stroke="#ccc" stroke-width="1" fill="none" stroke-dasharray="2,2" />
  <path d="M 595 630 L 595 680" stroke="#ccc" stroke-width="1" fill="none" stroke-dasharray="2,2" />
  <path d="M 595 740 L 595 790" stroke="#ccc" stroke-width="1" fill="none" stroke-dasharray="2,2" />
  <path d="M 595 850 L 595 900" stroke="#ccc" stroke-width="1" fill="none" stroke-dasharray="2,2" />

  <!-- Legend -->
  <g id="legend">
    <rect x="30" y="1050" width="1540" height="40" rx="5" fill="#f5f5f5" stroke="#ddd" stroke-width="1" />
    <text x="800" y="1070" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">
      Data Flow Legend
    </text>

    <line x1="250" y1="1080" x2="300" y2="1080" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
    <text x="310" y="1085" font-family="Arial, sans-serif" font-size="11" fill="#333">
      Request Flow
    </text>

    <line x1="450" y1="1080" x2="500" y2="1080" stroke="#666" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowReturn)" />
    <text x="510" y="1085" font-family="Arial, sans-serif" font-size="11" fill="#333">
      Response Flow
    </text>

    <line x1="700" y1="1080" x2="750" y2="1080" stroke="#ccc" stroke-width="1" stroke-dasharray="2,2" />
    <text x="760" y="1085" font-family="Arial, sans-serif" font-size="11" fill="#333">
      Execution Sequence
    </text>

    <rect x="950" y="1072" width="60" height="16" rx="3" fill="#4facfe" stroke="#0288d1" stroke-width="1" />
    <text x="1020" y="1085" font-family="Arial, sans-serif" font-size="11" fill="#333">
      Core Process
    </text>

    <rect x="1150" y="1072" width="60" height="16" rx="3" fill="#43e97b" stroke="#00bfa5" stroke-width="1" />
    <text x="1220" y="1085" font-family="Arial, sans-serif" font-size="11" fill="#333">
      Agent Task
    </text>

    <rect x="1320" y="1072" width="60" height="16" rx="3" fill="#fa709a" stroke="#ff9800" stroke-width="1" />
    <text x="1390" y="1085" font-family="Arial, sans-serif" font-size="11" fill="#333">
      MCP Call
    </text>
  </g>
</svg>
